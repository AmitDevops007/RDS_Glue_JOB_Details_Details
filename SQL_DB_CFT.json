{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "CloudFormation Template to create RDS MySQL Database",
  "Parameters": {
    "DBName": {
      "Type": "String",
      "Default": "mydb",
      "Description": "Database name"
    },
    "DBUsername": {
      "Type": "String",
      "Description": "Database admin username"
    },
    "DBPassword": {
      "Type": "String",
      "NoEcho": "true",
      "Description": "Database admin password",
      "MinLength": "8",
      "MaxLength": "41"
    },
    "DBInstanceClass": {
      "Type": "String",
      "Default": "db.t3.micro",
      "AllowedValues": [
        "db.t3.micro",
        "db.t3.small",
        "db.t3.medium"
      ],
      "Description": "RDS instance type"
    },
    "AllocatedStorage": {
      "Type": "Number",
      "Default": 20,
      "Description": "Storage size in GB"
    },
    "VpcSecurityGroupIds": {
      "Type": "String",
      "Description": "Security Group ID to attach to RDS"
    },
    "DBSubnetGroup": {
      "Type": "String",
      "Description": "Subnet Group Name"
    }
  },
  "Mappings": {
    "RegionMap": {
      "us-east-1": { "AMI": "ami-12345678" },
      "us-west-1": { "AMI": "ami-87654321" }
    }
  },
  "Resources": {
    "MyDBInstance": {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "DBName": { "Ref": "DBName" },
        "Engine": "mysql",
        "MasterUsername": { "Ref": "DBUsername" },
        "MasterUserPassword": { "Ref": "DBPassword" },
        "DBInstanceClass": { "Ref": "DBInstanceClass" },
        "AllocatedStorage": { "Ref": "AllocatedStorage" },
        "VPCSecurityGroups": [ { "Ref": "VpcSecurityGroupIds" } ],
        "DBSubnetGroupName": { "Ref": "DBSubnetGroup" },
        "BackupRetentionPeriod": 7,
        "PubliclyAccessible": false,
        "StorageType": "gp2",
        "MultiAZ": false
      }
    }
  },
  "Outputs": {
    "DBEndpoint": {
      "Description": "Database Endpoint",
      "Value": { "Fn::GetAtt": [ "MyDBInstance", "Endpoint.Address" ] }
    },
    "DBPort": {
      "Description": "Database Port",
      "Value": { "Fn::GetAtt": [ "MyDBInstance", "Endpoint.Port" ] }
    }
  }
}
